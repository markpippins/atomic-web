<aside 
  class="relative h-full flex flex-col bg-[rgb(var(--color-surface-sidebar))] border-r border-[rgb(var(--color-border-base))] ease-in-out"
  [class.transition-all]="!isResizing()"
  [class.duration-300]="!isResizing()"
  [style.width.px]="isCollapsed() ? 64 : width()">

  @if (!isCollapsed()) {
    <!-- EXPANDED VIEW -->
    <div class="flex-1 overflow-hidden">
      <app-tab-control (collapseClick)="toggleCollapse()">
        <app-tab title="Explorer">
          <div class="flex flex-col h-full">
            <!-- Tree View Toolbar -->
            <div class="flex-shrink-0 flex items-center h-12 px-2 border-b border-[rgb(var(--color-border-base))] bg-[rgb(var(--color-surface-muted))]">
              <button (click)="onRefreshTree()" title="Refresh" class="p-2 rounded-md hover:bg-[rgb(var(--color-surface-hover))]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[rgb(var(--color-text-muted))]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5M20 20v-5h-5M4 4l1.5 1.5A9 9 0 0120.5 10M20 20l-1.5-1.5A9 9 0 003.5 14" />
                </svg>
              </button>
              <div class="h-6 w-px bg-[rgb(var(--color-border-muted))] mx-1"></div>
              <button (click)="onExpandAll()" title="Expand All" class="p-2 rounded-md hover:bg-[rgb(var(--color-surface-hover))]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[rgb(var(--color-text-muted))]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5" />
                </svg>
              </button>
              <button (click)="onCollapseAll()" title="Collapse All" class="p-2 rounded-md hover:bg-[rgb(var(--color-surface-hover))]">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[rgb(var(--color-text-muted))]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8 4H4m0 0v4m0-4l5 5m1-1V4m0 0h4m0 0l-5 5m-4 11h4m0 0v-4m0 4l5-5m-1 1v4m0 0h-4m0 0l5-5" />
                </svg>
              </button>
            </div>
            <!-- Tree View -->
            <div class="flex-1 overflow-y-auto p-2">
              @if(folderTree(); as tree) {
                <app-tree-view 
                  [rootNode]="tree"
                  [currentPath]="currentPath()"
                  [expansionCommand]="treeExpansionCommand()"
                  [imageService]="imageService()"
                  (pathChange)="onTreeViewPathChange($event)"
                  (loadChildren)="onLoadChildren($event)">
                </app-tree-view>
              } @else {
                <div class="p-4 text-center text-[rgb(var(--color-text-subtle))] text-sm">Loading tree...</div>
              }
            </div>
          </div>
        </app-tab>
        <app-tab title="News">
          <app-newsfeed></app-newsfeed>
        </app-tab>
        <app-tab title="Search">
          <app-search></app-search>
        </app-tab>
      </app-tab-control>
    </div>
    
    <!-- Resizer Handle -->
    <div 
      class="absolute top-0 right-0 h-full w-1.5 cursor-col-resize group z-10"
      (mousedown)="startResize($event)">
        <div class="w-0.5 h-full mx-auto bg-transparent group-hover:bg-[rgb(var(--color-accent-ring))]/50 transition-colors duration-200"></div>
    </div>
  } @else {
    <!-- COLLAPSED VIEW -->
    <app-vertical-toolbar (expandClick)="toggleCollapse()"></app-vertical-toolbar>
  }
</aside>
