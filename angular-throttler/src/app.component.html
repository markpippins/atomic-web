<div class="flex flex-col h-screen font-sans antialiased text-[rgb(var(--color-text-base))] bg-[rgb(var(--color-background))]">
  <!-- Main Header -->
  <header class="flex-shrink-0 h-10 bg-[rgb(var(--color-surface))] border-b border-[rgb(var(--color-border-base))] flex items-center justify-end px-4 space-x-2">
    <!-- Connection Status -->
    <div class="flex-grow flex items-center">
        @switch (connectionStatus()) {
          @case ('connected') {
            <div class="flex items-center space-x-2">
              <div class="h-2.5 w-2.5 rounded-full bg-green-500"></div>
              <span class="text-sm font-medium text-[rgb(var(--color-text-muted))]">Connected</span>
            </div>
          }
          @case ('connecting') {
            <div class="flex items-center space-x-2">
              <div class="h-2.5 w-2.5 rounded-full bg-yellow-400 animate-pulse"></div>
              <span class="text-sm font-medium text-[rgb(var(--color-text-muted))]">Connecting...</span>
            </div>
          }
          @case ('disconnected') {
            <div class="flex items-center space-x-2">
              <div class="h-2.5 w-2.5 rounded-full bg-[rgb(var(--color-text-subtle))]"></div>
              <span class="text-sm font-medium text-[rgb(var(--color-text-subtle))]">Disconnected</span>
            </div>
          }
        }
    </div>

    <button (click)="openServerProfilesDialog()" class="flex items-center space-x-2 px-3 py-1 bg-[rgb(var(--color-surface))] hover:bg-[rgb(var(--color-surface-hover))] rounded-md shadow-sm border border-[rgb(var(--color-border-muted))] text-sm font-medium text-[rgb(var(--color-text-muted))] transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[rgb(var(--color-accent-ring))]">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm0 8a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2z" clip-rule="evenodd" />
      </svg>
      <span>Servers</span>
    </button>
    <div class="h-6 w-px bg-[rgb(var(--color-border-muted))]"></div>
    <div class="relative inline-block text-left">
      <button (click)="toggleThemeDropdown($event)" class="flex items-center space-x-2 px-3 py-1 bg-[rgb(var(--color-surface))] hover:bg-[rgb(var(--color-surface-hover))] rounded-md shadow-sm border border-[rgb(var(--color-border-muted))] text-sm font-medium text-[rgb(var(--color-text-muted))] transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[rgb(var(--color-accent-ring))]">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
          <path d="M5 4a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2V6a2 2 0 00-2-2H5zm0 2h10v6H5V6z" />
        </svg>
        <span>Theme</span>
      </button>

      @if(isThemeDropdownOpen()) {
        <div class="absolute right-0 z-10 mt-2 w-32 origin-top-right rounded-md bg-[rgb(var(--color-surface-dialog))] shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu">
          <div class="py-1" role="none">
            @for(theme of themes; track theme.id) {
              <div (click)="setTheme(theme.id)" class="text-[rgb(var(--color-text-muted))] hover:bg-[rgb(var(--color-surface-hover))] flex items-center px-4 py-2 text-sm cursor-pointer" role="menuitem">
                <span class="w-5">
                  @if (currentTheme() === theme.id) {
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-[rgb(var(--color-accent-text))]" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                  }
                </span>
                <span>{{ theme.name }}</span>
              </div>
            }
          </div>
        </div>
      }
    </div>
    <div class="h-6 w-px bg-[rgb(var(--color-border-muted))]"></div>
    <button (click)="toggleSplitView()" class="flex items-center space-x-2 px-3 py-1 bg-[rgb(var(--color-surface))] hover:bg-[rgb(var(--color-surface-hover))] rounded-md shadow-sm border border-[rgb(var(--color-border-muted))] text-sm font-medium text-[rgb(var(--color-text-muted))] transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[rgb(var(--color-accent-ring))]">
      @if (isSplitView()) {
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
          <path d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm9 4H6a1 1 0 000 2h8a1 1 0 000-2z" />
        </svg>
        <span>Merge</span>
      } @else {
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
          <path d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm2 4a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V8a1 1 0 00-1-1H7zm6 0a1 1 0 00-1 1v2a1 1 0 001 1h2a1 1 0 001-1V8a1 1 0 00-1-1h-2z" />
        </svg>
        <span>Split</span>
      }
    </button>
    <div class="h-6 w-px bg-[rgb(var(--color-border-muted))]"></div>
    <button 
      (click)="toggleDetailPane()" 
      class="flex items-center space-x-2 px-3 py-1 bg-[rgb(var(--color-surface))] hover:bg-[rgb(var(--color-surface-hover))] rounded-md shadow-sm border border-[rgb(var(--color-border-muted))] text-sm font-medium text-[rgb(var(--color-text-muted))] transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[rgb(var(--color-accent-ring))]"
      [class.bg-[rgb(var(--color-accent-bg))]]="isDetailPaneOpen()"
      [class.text-[rgb(var(--color-accent-text))]]="isDetailPaneOpen()">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
      </svg>
      <span>Details</span>
    </button>
  </header>

  <!-- Main Content -->
  <main class="flex-1 flex flex-row overflow-hidden">
    <app-sidebar 
      [folderTree]="folderTree()"
      [currentPath]="activePanePath()"
      [imageService]="defaultImageService()"
      (pathChange)="onSidebarNavigation($event)"
      (refreshTree)="loadFolderTree()"
      (loadChildren)="onLoadChildren($event)">
    </app-sidebar>

    <div class="flex-1 flex overflow-hidden">
      <div class="flex-1 flex bg-[rgb(var(--color-background))] p-1 gap-1">
        <div class="flex-1">
          <app-file-explorer 
            [id]="1"
            [path]="pane1Path()"
            [isActive]="activePaneId() === 1"
            [isSplitView]="isSplitView()"
            [fileSystemProvider]="pane1Provider()"
            [imageService]="pane1ImageService()"
            [folderTree]="folderTree()"
            [searchResults]="searchResultForPane()"
            (activated)="setActivePane($event)"
            (pathChanged)="onPane1PathChanged($event)"
            (searchInitiated)="openSearchDialog(1)"
            (searchCompleted)="onSearchCompleted()"
            (quickSearch)="executeQuickSearch(1, $event)"
            (itemSelected)="onItemSelectedInPane($event)"
            (directoryChanged)="loadFolderTree()">
          </app-file-explorer>
        </div>

        @if (isSplitView()) {
          <div class="flex-1">
            <app-file-explorer 
              [id]="2"
              [path]="pane2Path()"
              [isActive]="activePaneId() === 2"
              [isSplitView]="isSplitView()"
              [fileSystemProvider]="pane2Provider()"
              [imageService]="pane2ImageService()"
              [folderTree]="folderTree()"
              [searchResults]="searchResultForPane()"
              (activated)="setActivePane($event)"
              (pathChanged)="onPane2PathChanged($event)"
              (searchInitiated)="openSearchDialog(2)"
              (searchCompleted)="onSearchCompleted()"
              (quickSearch)="executeQuickSearch(2, $event)"
              (itemSelected)="onItemSelectedInPane($event)"
              (directoryChanged)="loadFolderTree()">
            </app-file-explorer>
          </div>
        }
      </div>
      
      @if (isDetailPaneOpen()) {
        <app-detail-pane
          [item]="selectedDetailItem()"
          [imageService]="activeImageService()"
          [fileSystemProvider]="activeProvider()"
          [providerPath]="activeProviderPath()"
          (close)="toggleDetailPane()">
        </app-detail-pane>
      }
    </div>
  </main>

  @if(isServerProfilesDialogOpen()) {
    <app-server-profiles-dialog 
      [mountedProfileIds]="mountedProfileIds()"
      [mountedProfileUsers]="mountedProfileUsers()"
      (close)="closeServerProfilesDialog()"
      (loginAndMount)="onLoginAndMount($event)"
      (unmountProfile)="onUnmountProfile($event)">
    </app-server-profiles-dialog>
  }

  @if(isSearchDialogOpen()) {
    <app-search-dialog
      (close)="closeSearchDialog()"
      (search)="executeSearch($event)">
    </app-search-dialog>
  }
</div>
