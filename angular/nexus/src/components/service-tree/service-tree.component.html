<div class="service-tree">
  @for (group of groupedServices(); track group.framework.id) {
    <div class="framework-group">
      <div 
        class="framework-header" 
        (click)="toggleFramework(group.framework.id)"
      >
        <mat-icon class="framework-icon">{{ getFrameworkIcon(group.framework.category) }}</mat-icon>
        <div class="framework-info">
          <div class="framework-name">{{ group.framework.name }}</div>
          <div class="framework-stats">
            {{ group.services.length }} services | 
            <span class="status-count healthy">{{ group.healthySummary.healthy }} healthy</span>,
            <span class="status-count unhealthy">{{ group.healthySummary.unhealthy }} unhealthy</span>,
            <span class="status-count unknown">{{ group.healthySummary.unknown }} unknown</span>
          </div>
        </div>
        <mat-icon class="expand-icon">
          {{ isFrameworkExpanded(group.framework.id) ? 'expand_more' : 'chevron_right' }}
        </mat-icon>
      </div>

      @if (isFrameworkExpanded(group.framework.id)) {
        <div class="service-list">
          @for (service of group.services; track service.id) {
            <div 
              class="service-item"
              [class.selected]="selectedService()?.id === service.id"
              (click)="selectService(service)"
            >
              <div 
                class="service-status" 
                [style.backgroundColor]="getHealthStatusColor(getDeploymentHealthStatus(service))"
                [title]="getDeploymentHealthStatus(service)"
              ></div>
              <div class="service-info">
                <div class="service-name">{{ service.name }}</div>
                <div class="service-details">
                  {{ service.framework.language }} | {{ service.version }} | {{ service.type }}
                  @if (service.defaultPort) {
                    <span class="port">:{{ service.defaultPort }}</span>
                  }
                </div>
              </div>
              <div class="service-actions">
                <button
                  mat-icon-button
                  (click)="restart(service); $event.stopPropagation();"
                  [disabled]="!canRestart(service)"
                  [title]="canRestart(service) ? 'Restart service' : 'Service cannot be restarted'"
                >
                  <mat-icon>refresh</mat-icon>
                </button>
                <button
                  mat-icon-button
                  (click)="viewServiceLogs(service); $event.stopPropagation();"
                  title="View logs"
                >
                  <mat-icon>description</mat-icon>
                </button>
              </div>
            </div>
          }
        </div>
      }
    </div>
  }

  @if (groupedServices().length === 0) {
    <div class="no-services">
      <p>No services found. Connect to a Host Server to view registered services.</p>
    </div>
  }
</div>