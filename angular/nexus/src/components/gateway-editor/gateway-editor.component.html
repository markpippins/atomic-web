<div class="h-full overflow-y-auto bg-[rgb(var(--color-surface))] p-6">
  @if (profile()) {
    <div class="space-y-6 max-w-3xl mx-auto">
      <!-- Header -->
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-semibold text-[rgb(var(--color-text-prominent))]">
            {{ profile()!.name }}
          </h2>
          <p class="mt-1 text-sm text-[rgb(var(--color-text-muted))]">
            Edit connection settings for this broker gateway.
          </p>
        </div>
        <div class="flex items-center space-x-3">
          @if (isMounted()) {
            <span
              class="text-xs font-bold text-[rgb(var(--color-status-blue-text))] bg-[rgb(var(--color-status-blue-bg))] px-2 py-0.5 rounded-full"
            >
              MOUNTED
            </span>
          }
          @if (saveSuccess()) {
            <span class="text-sm text-green-600 dark:text-green-400 flex items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 mr-1"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  clip-rule="evenodd"
                />
              </svg>
              Saved
            </span>
          }
          @if (isDirty()) {
            <button
              type="button"
              (click)="resetForm()"
              class="px-3 py-1.5 text-sm border border-[rgb(var(--color-border-base))] rounded-md text-[rgb(var(--color-text-base))] hover:bg-[rgb(var(--color-surface-hover))] transition-colors"
            >
              Reset
            </button>
          }
          <button
            type="button"
            (click)="saveProfile()"
            [disabled]="!isDirty() || isSaving()"
            class="px-4 py-1.5 text-sm border border-transparent rounded-md shadow-sm font-medium text-white bg-[rgb(var(--color-primary-600))] hover:bg-[rgb(var(--color-primary-700))] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[rgb(var(--color-primary-500))] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            @if (isSaving()) {
              <span class="flex items-center">
                <svg
                  class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"
                  ></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
                Saving...
              </span>
            } @else {
              Save Changes
            }
          </button>
        </div>
      </div>

      <!-- Connection Details Section -->
      <div
        class="bg-[rgb(var(--color-surface-muted))] rounded-lg p-5 border border-[rgb(var(--color-border-base))]"
      >
        <h3
          class="text-sm font-semibold text-[rgb(var(--color-text-prominent))] uppercase tracking-wide mb-4"
        >
          Profile Details
        </h3>
        <div class="grid grid-cols-1 gap-y-4 gap-x-6 sm:grid-cols-6">
          <div class="sm:col-span-6">
            <label for="name" class="block text-sm font-medium text-[rgb(var(--color-text-base))]"
              >Profile Name</label
            >
            <div class="mt-1">
              <input
                type="text"
                name="name"
                id="name"
                required
                [ngModel]="formState().name"
                (ngModelChange)="updateField('name', $event)"
                placeholder="e.g., Production Environment"
                class="shadow-sm focus:ring-[rgb(var(--color-primary-500))] focus:border-[rgb(var(--color-primary-500))] block w-full sm:text-sm border-[rgb(var(--color-border-base))] rounded-md bg-[rgb(var(--color-surface-input))] text-[rgb(var(--color-text-base))] px-3 py-2"
              />
            </div>
          </div>

          <div class="sm:col-span-6">
            <label
              for="brokerUrl"
              class="block text-sm font-medium text-[rgb(var(--color-text-base))]"
              >Broker Gateway Address</label
            >
            <div class="mt-1">
              <input
                type="text"
                name="brokerUrl"
                id="brokerUrl"
                [ngModel]="formState().brokerUrl"
                (ngModelChange)="updateField('brokerUrl', $event)"
                placeholder="e.g., localhost:8080"
                class="shadow-sm focus:ring-[rgb(var(--color-primary-500))] focus:border-[rgb(var(--color-primary-500))] block w-full sm:text-sm border-[rgb(var(--color-border-base))] rounded-md bg-[rgb(var(--color-surface-input))] text-[rgb(var(--color-text-base))] px-3 py-2"
              />
              <p class="mt-1 text-xs text-[rgb(var(--color-text-muted))]">
                URL for the Broker Gateway (e.g., for service discovery).
              </p>
            </div>
          </div>

          <div class="sm:col-span-6">
            <label
              for="imageUrl"
              class="block text-sm font-medium text-[rgb(var(--color-text-base))]"
              >Image Server URL</label
            >
            <div class="mt-1">
              <input
                type="text"
                name="imageUrl"
                id="imageUrl"
                [ngModel]="formState().imageUrl"
                (ngModelChange)="updateField('imageUrl', $event)"
                placeholder="http://..."
                class="shadow-sm focus:ring-[rgb(var(--color-primary-500))] focus:border-[rgb(var(--color-primary-500))] block w-full sm:text-sm border-[rgb(var(--color-border-base))] rounded-md bg-[rgb(var(--color-surface-input))] text-[rgb(var(--color-text-base))] px-3 py-2"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Health & Connection Section -->
      <div
        class="bg-[rgb(var(--color-surface-muted))] rounded-lg p-5 border border-[rgb(var(--color-border-base))]"
      >
        <h3
          class="text-sm font-semibold text-[rgb(var(--color-text-prominent))] uppercase tracking-wide mb-4"
        >
          Health & Connection
        </h3>
        <div class="grid grid-cols-1 gap-y-4 gap-x-6 sm:grid-cols-6">
          <div class="sm:col-span-3">
            <label
              for="healthCheckDelayMinutes"
              class="block text-sm font-medium text-[rgb(var(--color-text-base))]"
              >Health Check Delay (minutes)</label
            >
            <div class="mt-1">
              <input
                type="number"
                name="healthCheckDelayMinutes"
                id="healthCheckDelayMinutes"
                min="1"
                [ngModel]="formState().healthCheckDelayMinutes"
                (ngModelChange)="updateField('healthCheckDelayMinutes', $event)"
                placeholder="Default (e.g., 3)"
                class="shadow-sm focus:ring-[rgb(var(--color-primary-500))] focus:border-[rgb(var(--color-primary-500))] block w-full sm:text-sm border-[rgb(var(--color-border-base))] rounded-md bg-[rgb(var(--color-surface-input))] text-[rgb(var(--color-text-base))] px-3 py-2"
              />
              <p class="mt-1 text-xs text-[rgb(var(--color-text-muted))]">
                Overrides the default delay for this specific profile's image server.
              </p>
            </div>
          </div>

          <div class="sm:col-span-3 flex items-end">
            <div class="flex items-center h-10">
              <input
                type="checkbox"
                name="autoConnect"
                id="autoConnect"
                [ngModel]="formState().autoConnect"
                (ngModelChange)="updateField('autoConnect', $event)"
                class="h-4 w-4 rounded border-[rgb(var(--color-border-base))] text-[rgb(var(--color-primary-600))] focus:ring-[rgb(var(--color-primary-500))]"
              />
              <label
                for="autoConnect"
                class="ml-2 block text-sm font-medium text-[rgb(var(--color-text-base))]"
              >
                Auto-connect on startup
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div
      class="h-full flex flex-col items-center justify-center text-[rgb(var(--color-text-muted))]"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-16 w-16 mb-4 opacity-50"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="1"
          d="M5 12h14M12 5l7 7-7 7"
        />
      </svg>
      <p class="text-lg font-medium">Gateway profile not found</p>
    </div>
  }
</div>
